
















<!DOCTYPE html>
<html lang='ko'><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <link rel="shortcut icon" href='//localhost:1313/favicon.ico' type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>컨트롤 플레인 - Hori</title>

    
    <meta name="description" content="Linkerd 프록시‐인젝터 컨트롤러가 Kubernetes에서 새로운 Pod에 사이드카 프록시를 어떻게 자동으로 주입하는지 심층 분석합니다." />
    

    

    
    <meta name="author" content="Ivan Porta" />
    

    

    <link rel="stylesheet" href="/style.css" integrity="">





    
    <script>
        if (!('theme' in localStorage)) {
            localStorage.theme = 'light';
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute("data-theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "light");
        }
    </script>
<script defer src="/js/header.js" integrity=""></script>



    <script defer src="/js/zooming.js" integrity=""></script>







    
        
        
            <script defer src="/js/builtin-copy.js" integrity=""></script>
        
    



    
    
    
    <script defer src="/js/search-ko.js" integrity=""></script>




<link rel="stylesheet" href="//localhost:1313/user.css">

    
</head>
<body><header>
    <div id="header_left">
        <div id="sidebar_btn">
            <input type="checkbox" id="sidebar_btn_input" class="hidden" />
            <label id="sidebar_btn_label" for="sidebar_btn_input">
                <svg id="menu_icon" width="26px" height="26px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg>

</svg>
            </label>
            <label id="sidebar_canvas_overlay_wrapper" for="sidebar_btn_input">
                <div id="sidebar_canvas_overlay"></div>
            </label>
            <div id="sidebar">
                <ul><li>
                            <a href="/ko/control-plane/">제어 플레인</a>
    <ul>
        

            
                <li>
                    
                        <a href="/ko/control-plane/destination">목적지 컨트롤러</a>
                    
                </li>
            
        

            
                <li>
                    
                        <a href="/ko/control-plane/proxy-injector">컨트롤 플레인&#39;</a>
                    
                </li>
            
        
    </ul>
</li><li>
                            <a href="/ko/data-plane/">데이터 플레인</a>
    <ul>
        

            
                <li>
                    
                        <a href="/ko/data-plane/proxy-init">프록시 초기화</a>
                    
                </li>
            
        
    </ul>
</li><li>
                            <a href="/ko/modules/">모듈</a>
    <ul>
        

            
                <li>
                    
                        <a href="/ko/modules/certificates">인증서</a>
                    
                </li>
            
        

            
                <li>
                    
                        <a href="/ko/modules/timeouts">타임아웃</a>
                    
                </li>
            
        

            
                <li>
                    
                        <a href="/ko/modules/cli">Linkerd 커맨드라인 인터페이스</a>
                    
                </li>
            
        
    </ul>
</li><li>
                            <a href="/ko/changelog/">변경 로그</a></li></ul>
            </div>
        </div>
    
        <div class="brand">
            <div>
                <a href="/ko/">Hori</a>
            </div>
        </div>
    </div>

    <div class="toolbox">
        <div id="theme_tool">
            <svg id="dark_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

</svg>
            <svg id="light_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>

</svg>
        </div>

        
            <div id="search_tool">
                <svg id="search_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>

</svg><div id="search_menu_wrapper" class="hidden">
    <div id="search_menu">
        <div id="search_menu_toolbar">
            <div id="search_menu_input_wrapper">
                <input id="search_menu_input" type="text" placeholder='Search Posts'>
            </div>
            <div id="search_menu_close_btn">
                <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
</svg>

</svg>
            </div>
        </div>
        <div id="search_menu_results">
        </div>
    </div>
</div>
</div>
        

        
            <div id="translation_tool" class="dropdown-wrapper pure-menu pure-menu-horizontal toolbox-btn" onclick="void(0)">
                <ul class="pure-menu-list">
                    <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
                        <div class="dropdown-btn pure-menu-link">
                            <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
</svg>

</svg>
                            <span class="dropdown-desc">한국어</span>
                        </div>
                        <ul class="pure-menu-children">
                            
                            <li class="pure-menu-item">
                                <a href="//localhost:1313/" class="pure-menu-link">English</a>
                            </li>
                            
                            <li class="pure-menu-item">
                                <a href="//localhost:1313/ko/" class="pure-menu-link">한국어</a>
                            </li>
                            
                        </ul>
                    </li>
                </ul>
            </div>
        
    </div>
</header>
<nav id="navbar" class="pure-menu">
    <ul class="pure-menu-list"><li class="navbar-item navbar-dropdown pure-menu-item pure-menu-has-children pure-menu-allow-hover insection">
                    
                        <a href="/ko/control-plane/" class="pure-menu-link">제어 플레인</a>
                    
                    <ul class="pure-menu-children">

    
        <li class="pure-menu-item">
            
                <a href="/ko/control-plane/destination" class="pure-menu-link">목적지 컨트롤러</a>
            
        </li>
    


    
        <li class="pure-menu-item">
            
                <a href="/ko/control-plane/proxy-injector" class="pure-menu-link">컨트롤 플레인&#39;</a>
            
        </li>
    

</ul>
                </li><li class="navbar-item navbar-dropdown pure-menu-item pure-menu-has-children pure-menu-allow-hover ">
                    
                        <a href="/ko/data-plane/" class="pure-menu-link">데이터 플레인</a>
                    
                    <ul class="pure-menu-children">

    
        <li class="pure-menu-item">
            
                <a href="/ko/data-plane/proxy-init" class="pure-menu-link">프록시 초기화</a>
            
        </li>
    

</ul>
                </li><li class="navbar-item navbar-dropdown pure-menu-item pure-menu-has-children pure-menu-allow-hover ">
                    
                        <a href="/ko/modules/" class="pure-menu-link">모듈</a>
                    
                    <ul class="pure-menu-children">

    
        <li class="pure-menu-item">
            
                <a href="/ko/modules/certificates" class="pure-menu-link">인증서</a>
            
        </li>
    


    
        <li class="pure-menu-item">
            
                <a href="/ko/modules/timeouts" class="pure-menu-link">타임아웃</a>
            
        </li>
    


    
        <li class="pure-menu-item">
            
                <a href="/ko/modules/cli" class="pure-menu-link">Linkerd 커맨드라인 인터페이스</a>
            
        </li>
    

</ul>
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/ko/changelog/" class="pure-menu-link">변경 로그</a>
                    
                </li></ul>
</nav>
<main>
            <div id="content" class="content-margin">
                


    <div class="content-margin">



<article class="line-numbers">
    
    
    
<h2 id="linkerd-proxy-injector" class="header-anchor-wrapper">Linkerd Proxy-Injector
  <a href="#linkerd-proxy-injector" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>Linkerd Proxy-Injector는 새로운 Pod(또는 Service)가 생성될 때 Kubernetes API에 대한 요청을 가로채는 mutating webhook을 사용합니다. 네임스페이스 또는 Pod가 <code>linkerd.io/inject: enabled</code> 주석으로 설정되어 있으면, 해당 webhook은 Pod 사양에 Linkerd 프록시 및 ProxyInit 컨테이너를 주입합니다.</p>

<h1 id="사전-요구-사항" class="header-anchor-wrapper">사전 요구 사항
  <a href="#%ec%82%ac%ec%a0%84-%ec%9a%94%ea%b5%ac-%ec%82%ac%ed%95%ad" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h1>

<ul>
<li>macOS/Linux/Windows (유닉스 스타일 셸 환경)</li>
<li>로컬 Kubernetes 클러스터용 k3d(v5+)</li>
<li>kubectl(v1.25+)</li>
<li>Helm(v3+)</li>
<li>인증서 생성을 위한 Smallstep(step) CLI</li>
</ul>

<h1 id="튜토리얼" class="header-anchor-wrapper">튜토리얼
  <a href="#%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h1>


<h2 id="1-구성-파일-생성" class="header-anchor-wrapper">1. 구성 파일 생성
  <a href="#1-%ea%b5%ac%ec%84%b1-%ed%8c%8c%ec%9d%bc-%ec%83%9d%ec%84%b1" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<pre><code>cat &lt;&lt; 'EOF' &gt; audit-policy.yaml
apiVersion: audit.k8s.io/v1
kind: Policy
rules:
  - level: RequestResponse
    resources:
      - group: &quot;&quot;
        resources: [&quot;*&quot;]
  - level: RequestResponse
    resources:
      - group: &quot;linkerd.io&quot;
        resources: [&quot;*&quot;]
      - group: &quot;policy.linkerd.io&quot;
        resources: [&quot;*&quot;]
      - group: &quot;gateway.networking.k8s.io&quot;
        resources: [&quot;*&quot;]
  - level: None
EOF
cat &lt;&lt; 'EOF' &gt; cluster.yaml
apiVersion: k3d.io/v1alpha5
kind: Simple
metadata:
  name: &quot;cluster&quot;
servers: 1
agents: 0
image: rancher/k3s:v1.33.0-k3s1
network: playground
options:
  k3s:
    extraArgs:
      - arg: --disable=traefik
        nodeFilters: [&quot;server:*&quot;]
      - arg: --cluster-cidr=10.23.0.0/16
        nodeFilters: [&quot;server:*&quot;]
      - arg: --service-cidr=10.247.0.0/16
        nodeFilters: [&quot;server:*&quot;]
      - arg: --debug
        nodeFilters: [&quot;server:*&quot;]
      - arg: --kube-apiserver-arg=audit-policy-file=/etc/rancher/k3s/audit-policy.yaml
        nodeFilters: [&quot;server:*&quot;]
      - arg: --kube-apiserver-arg=audit-log-path=/var/log/kubernetes/audit/audit.log
        nodeFilters: [&quot;server:*&quot;]
ports:
  - port: 8081:80
    nodeFilters: [&quot;loadbalancer&quot;]
volumes:
  - volume: &quot;&lt;LOCAL-FULL-PATH&gt;/audit-policy.yaml:/etc/rancher/k3s/audit-policy.yaml&quot;
    nodeFilters: [&quot;server:*&quot;]
EOF
cat &lt;&lt; 'EOF' &gt; application.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: simple-app
  annotations:
    linkerd.io/inject: enabled
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: simple-app-v1
  namespace: simple-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: server
      version: v1
  template:
    metadata:
      labels:
        app: server
        version: v1
    spec:
      containers:
        - name: http-app
          image: kong/httpbin:latest
          ports:
            - containerPort: 80
EOF
</code></pre>

<h2 id="2-로컬-kubernetes-클러스터-생성" class="header-anchor-wrapper">2. 로컬 Kubernetes 클러스터 생성
  <a href="#2-%eb%a1%9c%ec%bb%ac-kubernetes-%ed%81%b4%eb%9f%ac%ec%8a%a4%ed%84%b0-%ec%83%9d%ec%84%b1" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>k3d와 cluster.yaml을 사용하여 가벼운 Kubernetes 클러스터를 실행합니다:</p>
<pre><code>k3d cluster create --kubeconfig-update-default \
  -c ./cluster.yaml
</code></pre>

<h2 id="3-인증서-생성" class="header-anchor-wrapper">3. 인증서 생성
  <a href="#3-%ec%9d%b8%ec%a6%9d%ec%84%9c-%ec%83%9d%ec%84%b1" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>Linkerd는 mTLS ID를 위해 신뢰 앵커(루트 CA)와 발급자(중간 CA)가 필요합니다.</p>
<pre><code>step certificate create root.linkerd.cluster.local ./certificates/ca.crt ./certificates/ca.key \
    --profile root-ca \
    --no-password \
    --insecure
step certificate create identity.linkerd.cluster.local ./certificates/issuer.crt ./certificates/issuer.key \
    --profile intermediate-ca \
    --not-after 8760h \
    --no-password \
    --insecure \
    --ca ./certificates/ca.crt \
    --ca-key ./certificates/ca.key
</code></pre>

<h2 id="4-helm을-통한-linkerd-설치" class="header-anchor-wrapper">4. Helm을 통한 Linkerd 설치
  <a href="#4-helm%ec%9d%84-%ed%86%b5%ed%95%9c-linkerd-%ec%84%a4%ec%b9%98" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<pre><code>helm repo add linkerd-edge https://helm.linkerd.io/edge
helm repo update
helm install linkerd-crds linkerd-edge/linkerd-crds \
  -n linkerd --create-namespace --set installGatewayAPI=true
helm upgrade --install linkerd-control-plane \
  -n linkerd \
  --set-file identityTrustAnchorsPEM=./certificates/ca.crt \
  --set-file identity.issuer.tls.crtPEM=./certificates/issuer.crt \
  --set-file identity.issuer.tls.keyPEM=./certificates/issuer.key \
  --set controllerLogLevel=debug \
  --set policyController.logLevel=debug \
  linkerd-edge/linkerd-control-plane
</code></pre>

<h2 id="5-샘플-애플리케이션-배포" class="header-anchor-wrapper">5. 샘플 애플리케이션 배포
  <a href="#5-%ec%83%98%ed%94%8c-%ec%95%a0%ed%94%8c%eb%a6%ac%ec%bc%80%ec%9d%b4%ec%85%98-%eb%b0%b0%ed%8f%ac" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p><code>simple-app</code> 네임스페이스에 <code>linkerd.io/inject: enabled</code> 주석이 설정되어 있으므로, Linkerd의 proxy-injector webhook이 자동으로 <code>simple-app-v1</code> Deployment의 Pod에 사이드카를 주입합니다.</p>
<pre><code>kubectl apply -f ./application.yaml
</code></pre>
<p>이 시점에서 Kubernetes는 Deployment의 ReplicaSet 생성 요청과 이후 Pod 생성 요청을 보냅니다.</p>

<h2 id="6-interactions-with-the-kuberentes-api" class="header-anchor-wrapper">6. Interactions with the Kuberentes API
  <a href="#6-interactions-with-the-kuberentes-api" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p><code>application.yaml</code>을 적용하면 Kubernetes는 해당 리소스를 처리하고 일치하는 mutating webhook에 요청을 보냅니다. Linkerd의 경우, 이는 <code>linkerd-proxy-injector-webhook</code>(<code>MutatingWebhookConfiguration</code>에 구성됨)입니다. 여기서는 해당 webhook 구성의 요약된 뷰를 확인할 수 있습니다:</p>
<pre><code>kubectl get mutatingwebhookconfiguration linkerd-proxy-injector-webhook-config -o yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: linkerd-proxy-injector-webhook-config
webhooks:
- admissionReviewVersions:
  - v1
  - v1beta1
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURVakNDQWpxZ0F3SUJBZ0lRSzVya2tEMHVmQVNyRTRPeEV0Q2JTekFOQmdrcWhraUc5dzBCQVFzRkFEQXQKTVNzd0tRWURWUVFERXlKc2FXNXJaWEprTFhCeWIzaDVMV2x1YW1WamRHOXlMbXhwYm10bGNtUXVjM1pqTUI0WApEVEkxTURZd05ERXhNVGcxTVZvWERUSTJNRFl3TkRFeE1UZzFNVm93TFRFck1Da0dBMVVFQXhNaWJHbHVhMlZ5ClpDMXdjbTk0ZVMxcGJtcGxZM1J2Y2k1c2FXNXJaWEprTG5OMll6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQUQKZ2dFUEFEQ0NBUW9DZ2dFQkFNOGM3ZXNMNXhNakxFMzlXYUMwZVpJOThtTVhSK24zTUdvWHJJSXc0S3NCeUw1QwpuWHp3Um9ISTV1WnVMR1ZMY0N6L1h0YWozWWp3T0RhL2pLODVKRHZ4ajF2MTFMV3J2NWN5b1ladTBJRm8ybkVLCnpIY21TdVJZSjJwSHFFOHhZQXRmcnh0SktDdldWK3FZTTFLTTI2V1lVT2kzSU9DVGNoV0d4MS9vSENCclFiUnAKalRpSUEvY2d3QU55dXpqQUV3a1ZCRWl4UE92YnduVHl4YmhDZVFBTGZCV2JiM3Z6MGJwTUVKOUxpNkoxVms2egpWOW9ycFA2UW0yam1iNHJ3SElWVGRTN1dXOXU5YWY5SEFGdlozeFdldHhYRXkzRzNvSEl0REFiQ3YyemhaZDNWCkVlYmZHdGR3RDFTQmNqbnlHbTllc1IzSlMySU4vejRKWC9KWmoyVUNBd0VBQWFOdU1Hd3dEZ1lEVlIwUEFRSC8KQkFRREFnV2dNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUZCUWNEQWpBTUJnTlZIUk1CQWY4RQpBakFBTUMwR0ExVWRFUVFtTUNTQ0lteHBibXRsY21RdGNISnZlSGt0YVc1cVpXTjBiM0l1YkdsdWEyVnlaQzV6CmRtTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBR1pxRlFFY0g0THBqK0l5K1dwVFY1VTFuOHFqRGNOMFcyS3AKMHg0T25RaHp3NkZNUm8rR2NBdUR0Nk5kNkROVlZHZjNEdFBtcXhBM21wTUxDTDFSbytnUm9FSWg5N3pxdlZjSQpNalBmeXpkNGhRQ09ocmhyblJFazh2OEN6Rm5YREtPYmkyaUx1THVTNlJtc3I0alpPV2FrdWRKTzlqaUREUmJVCnlvcHhpWTgycW81VmNoT1IvaGg4K1o3S1FKL29lT29BMlp0Zk9QbmZ0VGYvenBwekJPQmtXRUxvYlRRVHRUbUoKbVdNaS9URUQ5QlE4U0NMUU5TUk1SRXpuaElFTGhja0lPVzBqMkNkYmJWWXdkZ2wrTSt1aVYweHdlTk9pQ2RxZApyZm9Yamp6TTh6MWk1Y0FzMS9IcGcvaEt2czlpM2hKNHQwd0NrZ0JQVXcyZzQxN29MU2s9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=
    service:
      name: linkerd-proxy-injector
      namespace: linkerd
      path: /
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: linkerd-proxy-injector.linkerd.io
  namespaceSelector:
    matchExpressions:
    - key: config.linkerd.io/admission-webhooks
      operator: NotIn
      values:
      - disabled
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
      - cert-manager
  objectSelector:
    matchExpressions:
    - key: linkerd.io/control-plane-component
      operator: DoesNotExist
    - key: linkerd.io/cni-resource
      operator: DoesNotExist
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - &quot;&quot;
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
    - services
    scope: Namespaced
  sideEffects: None
  timeoutSeconds: 10
</code></pre>
<p>이 mutating webhook은 다음을 수행합니다:</p>
<ul>
<li><code>config.linkerd.io/admission-webhooks=disabled</code>가 설정되지 않은 네임스페이스에서 생성된 모든 Pod 또는 Service를 이 웹훅으로 전송합니다. 또한 <code>linkerd.io/control-plane-component</code> 또는 <code>linkerd.io/cni-resource</code> 레이블이 있는 객체와 <code>kube-system</code>, <code>cert-manager</code> 시스템 네임스페이스는 무시합니다.</li>
<li><code>linkerd</code> 네임스페이스의 <code>linkerd-proxy-injector</code> 서비스(port 443)를 가리킵니다.</li>
</ul>
<p><code>linkerd-proxy-injector</code> Pod 내부를 살펴보면:</p>
<ul>
<li>차트 렌더링된 values.yaml이 포함된 <code>linkerd-config</code> ConfigMap을 마운트하여 프록시 이미지, 불투명 포트, 리소스 제한 등의 기본값을 확인합니다.</li>
<li>신뢰 앵커 인증서가 포함된 <code>linkerd-identity-trust-roots</code> ConfigMap을 마운트합니다.</li>
</ul>
<pre><code>kubectl get pods -n linkerd linkerd-proxy-injector-******** -o yaml
apiVersion: v1
kind: Pod
  ...
  name: linkerd-proxy-injector-********
  namespace: linkerd
spec:
  containers:
  ...
  - args:
    - proxy-injector
    - -log-level=debug
    - -log-format=plain
    - -linkerd-namespace=linkerd
    - -enable-pprof=false
    image: ghcr.io/buoyantio/controller:enterprise-2.18.0
    ...
    name: proxy-injector
    ports:
    - containerPort: 8443
      name: proxy-injector
      protocol: TCP
    - containerPort: 9995
      name: admin-http
      protocol: TCP
    volumeMounts:
    - mountPath: /var/run/linkerd/config
      name: config
    - mountPath: /var/run/linkerd/identity/trust-roots
      name: trust-roots
    - mountPath: /var/run/linkerd/tls
      name: tls
      readOnly: true
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: kube-api-access
      readOnly: true
  volumes:
  - configMap:
      defaultMode: 420
      name: linkerd-config
    name: config
  - configMap:
      defaultMode: 420
      name: linkerd-identity-trust-roots
    name: trust-roots
  - name: tls
    secret:
      defaultMode: 420
      secretName: linkerd-proxy-injector-k8s-tls
  - name: kube-api-access
    projected:
      defaultMode: 420
      sources:
      - serviceAccountToken:
          expirationSeconds: 3607
          path: token
      - configMap:
          items:
          - key: ca.crt
            path: ca.crt
          name: kube-root-ca.crt
      - downwardAPI:
          items:
          - fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
            path: namespace
  - emptyDir: {}
    name: linkerd-proxy-init-xtables-lock
  - name: linkerd-identity-token
    projected:
      defaultMode: 420
      sources:
      - serviceAccountToken:
          audience: identity.l5d.io
          expirationSeconds: 86400
          path: linkerd-identity-token
  - emptyDir:
      medium: Memory
    name: linkerd-identity-end-entity
</code></pre>
<p>웹훅 바이너리가 요청을 처리하기 시작하면, 먼저 <code>linkerd-config</code> ConfigMap과 <code>linkerd-identity-trust-roots</code> ConfigMap이 마운트된 볼륨을 읽어서, 주입 시 사용할 구성 및 올바른 신뢰 앵커를 가져옵니다.</p>
<pre><code>valuesConfig, err := config.Values(pkgK8s.MountPathValuesConfig)
if err != nil {
  return nil, err
}
caPEM, err := os.ReadFile(pkgK8s.MountPathTrustRootsPEM)
if err != nil {
  return nil, err
}
valuesConfig.IdentityTrustAnchorsPEM = string(caPEM)
</code></pre>
<p>다음으로, 웹훅은 네임스페이스 객체를 가져와 네임스페이스 수준의 Linkerd 주석을 읽습니다. 이는 해당 값들이 Pod 자체에 주석으로 전파되기 때문에 중요합니다.</p>
<pre><code>ns, err := api.Get(k8s.NS, request.Namespace)
if err != nil {
  return nil, err
}
</code></pre>
<p>그런 다음, 아래를 포함하는 <code>ResourceConfig</code> 구조체를 구성합니다:</p>
<ul>
<li>차트 값과 Pod 주석에서 가져온 모든 재정의값</li>
<li>모든 네임스페이스 수준의 Linkerd 주석(네임스페이스에서 설정된 주석은 각 Pod에 자동으로 상속됨)</li>
<li>리소스 종류(예: “Pod” 또는 “Deployment” 등) — 리소스가 Deployment인 경우 Pod 템플릿을 찾는 데 필요</li>
<li>Kubernetes Event(Injected 또는 Skipped)가 최고 수준의 소유자에 연결될 수 있도록, 부모 리소스를 조회하는 “OwnerRetriever” 함수</li>
</ul>
<pre><code>resourceConfig := inject.NewResourceConfig(valuesConfig, inject.OriginWebhook, linkerdNamespace).
  WithOwnerRetriever(ownerRetriever(ctx, api, request.Namespace)).
  WithNsAnnotations(ns.GetAnnotations()).
  WithKind(request.Kind.Kind)
...
func NewResourceConfig(values *l5dcharts.Values, origin Origin, ns string) *ResourceConfig {
	config := &amp;ResourceConfig{
		namespace:     ns,
		nsAnnotations: make(map[string]string),
		values:        values,
		origin:        origin,
	}
	config.workload.Meta = &amp;metav1.ObjectMeta{}
	config.pod.meta = &amp;metav1.ObjectMeta{}
	config.pod.labels = map[string]string{k8s.ControllerNSLabel: ns}
	config.pod.annotations = map[string]string{}
	return config
}
func (conf *ResourceConfig) WithOwnerRetriever(f OwnerRetrieverFunc) *ResourceConfig {
	conf.ownerRetriever = f
	return conf
}
func (conf *ResourceConfig) WithNsAnnotations(m map[string]string) *ResourceConfig {
	conf.nsAnnotations = m
	return conf
}
func (conf *ResourceConfig) WithKind(kind string) *ResourceConfig {
	conf.workload.metaType = metav1.TypeMeta{Kind: kind}
	return conf
}
</code></pre>
<p>이 시점에서 웹훅은 admission 요청의 원시 JSON 바이트를 Kubernetes 객체로 역직렬화하고, ResourceConfig 구조체의 추가 필드를 채웁니다:</p>
<ul>
<li>리소스가 Deployment, StatefulSet, Service 등인 경우 <code>resourceConfig.workload.metatype</code> 및 <code>resourceConfig.workload.meta</code></li>
<li>객체에 PodTemplate이 있는 경우(예: Deployment 템플릿) <code>resourceConfig.pod.spec</code> 및 <code>resourceConfig.pod.meta</code></li>
<li>컨트롤러 소유자 참조가 있는 경우(ownerRef) <code>resourceConfig.ownerRef</code></li>
</ul>
<pre><code>report, err := resourceConfig.ParseMetaAndYAML(request.Object.Raw)
if err != nil {
  return nil, err
}
log.Infof(&quot;received %s&quot;, report.ResName())
</code></pre>
<p>로그에는 다음과 같은 항목이 표시됩니다:</p>
<pre><code>time=&quot;2025-06-04T11:19:18Z&quot; level=info msg=&quot;received service/simple-app-v1&quot;
time=&quot;2025-06-04T11:19:18Z&quot; level=info msg=&quot;received admission review request \&quot;919c6889-a59c-4168-be0d-6d448460af98\&quot;&quot;
</code></pre>
<p>리소스에 상위 리소스(예: ReplicaSet이 관리하는 Deployment의 Pod)가 있으면, 해당 코드는 부모 리소스를 조회하여 Kubernetes Event(Injected 또는 Skipped)가 상위 리소스에 연결되도록 합니다.</p>
<pre><code>var parent *metav1.PartialObjectMetadata
var ownerKind string
if ownerRef := resourceConfig.GetOwnerRef(); ownerRef != nil {
  res, err := k8s.GetAPIResource(ownerRef.Kind)
  if err != nil {
    log.Tracef(&quot;skipping event for parent %s: %s&quot;, ownerRef.Kind, err)
  } else {
    objs, err := api.GetByNamespaceFiltered(res, request.Namespace, ownerRef.Name, labels.Everything())
    if err != nil {
      log.Warnf(&quot;couldn't retrieve parent object %s-%s-%s; error: %s&quot;, request.Namespace, ownerRef.Kind, ownerRef.Name, err)
    } else if len(objs) == 0 {
      log.Warnf(&quot;couldn't retrieve parent object %s-%s-%s&quot;, request.Namespace, ownerRef.Kind, ownerRef.Name)
    } else {
      parent = objs[0]
    }
    ownerKind = strings.ToLower(ownerRef.Kind)
  }
}
</code></pre>
<p>이러한 준비가 완료되면, 웹훅은 <code>report.Injectable()</code>을 호출하여 주입 여부를 결정합니다. 이를 위해 다음을 확인합니다:</p>
<ul>
<li>HostNetwork 모드 여부(Host 네트워크일 경우 iptables 사용 불가)</li>
<li>이미 사이드카가 존재하여 주입이 중복되는지 여부</li>
<li>지원되지 않는 리소스 종류 여부</li>
<li>주입을 비활성화하는 명시적 주석 여부</li>
<li>Pod가 ServiceAccount 토큰을 자동 마운트하는지 여부(mTLS에 필요)</li>
<li>이러한 검사 중 하나라도 실패하면, 함수는 <code>false</code>와 하나 이상의 사람이 읽을 수 있는 이유를 반환합니다.</li>
</ul>
<pre><code>injectable, reasons := report.Injectable()
...
func (r *Report) Injectable() (bool, []string) {
	var reasons []string
	if r.HostNetwork {
		reasons = append(reasons, hostNetworkEnabled)
	}
	if r.Sidecar {
		reasons = append(reasons, sidecarExists)
	}
	if r.UnsupportedResource {
		reasons = append(reasons, unsupportedResource)
	}
	if r.InjectDisabled {
		reasons = append(reasons, r.InjectDisabledReason)
	}

	if !r.AutomountServiceAccountToken {
		reasons = append(reasons, disabledAutomountServiceAccountToken)
	}

	if len(reasons) &gt; 0 {
		return false, reasons
	}
	return true, nil
}
</code></pre>
<p>Injectable()이 true를 반환하면, 웹훅은 주입을 진행하며 다음을 수행합니다:</p>
<ul>
<li><code>config.linkerd.io/created-by</code> 주석 추가</li>
<li>네임스페이스 수준의 Linkerd 주석(예: CPU/메모리 제한, 프록시 이미지 재정의)을 Pod 템플릿에 복사(Pod에 명시되지 않은 경우)</li>
<li>Pod에 <code>config.linkerd.io/opaque-ports</code> 주석이 없으면, <code>valuesConfig.Proxy.OpaquePorts</code>로부터 기본 불투명 포트 목록을 분리하여 Pod 사양의 실제 컨테이너 포트와 비교한 뒤, 일치하는 포트만 주석으로 설정</li>
</ul>
<p>그런 다음 <code>resourceConfig.GetPodPatch(true)</code>를 호출하여 JSON 패치를 생성합니다. 이 패치는 다음을 수행합니다:</p>
<ul>
<li><code>linkerd-init</code> init 컨테이너(iptables 규칙 프로그래밍)를 추가</li>
<li>필요한 모든 환경 변수, 볼륨 마운트 및 명령줄 플래그를 갖춘 <code>linkerd-proxy</code> 사이드카 컨테이너를 추가</li>
<li><code>config.linkerd.io/opaque-ports</code> 및 <code>config.linkerd.io/created-by</code> 주석을 추가
프록시가 컨트롤 플레인과 보안 통신을 할 수 있도록 신뢰 앵커와 TLS 비밀을 마운트</li>
<li>부모가 있으면, 부모 리소스에 Injected 이유와 <strong>Linkerd sidecar proxy injected.</strong> 메시지를 가진 Kubernetes Event를 생성</li>
<li>INFO 수준에서 생성된 패치를 로그에 기록하고, 전체 JSON 패치를 DEBUG 수준으로 출력</li>
</ul>
<pre><code>if injectable {
  resourceConfig.AppendPodAnnotation(pkgK8s.CreatedByAnnotation, fmt.Sprintf(&quot;linkerd/proxy-injector %s&quot;, version.Version))
  inject.AppendNamespaceAnnotations(resourceConfig.GetOverrideAnnotations(), resourceConfig.GetNsAnnotations(), resourceConfig.GetWorkloadAnnotations())
  if !resourceConfig.HasWorkloadAnnotation(pkgK8s.ProxyOpaquePortsAnnotation) {
    defaultPorts := strings.Split(resourceConfig.GetValues().Proxy.OpaquePorts, &quot;,&quot;)
    filteredPorts := resourceConfig.FilterPodOpaquePorts(defaultPorts)
    if len(filteredPorts) != 0 {
      ports := strings.Join(filteredPorts, &quot;,&quot;)
      resourceConfig.AppendPodAnnotation(pkgK8s.ProxyOpaquePortsAnnotation, ports)
    }
  }
  patchJSON, err := resourceConfig.GetPodPatch(true)
  if err != nil {
    return nil, err
  }
  if parent != nil {
    recorder.Event(parent, v1.EventTypeNormal, eventTypeInjected, &quot;Linkerd sidecar proxy injected&quot;)
  }
  log.Infof(&quot;injection patch generated for: %s&quot;, report.ResName())
  log.Debugf(&quot;injection patch: %s&quot;, patchJSON)
  proxyInjectionAdmissionResponses.With(admissionResponseLabels(ownerKind, request.Namespace, &quot;false&quot;, &quot;&quot;, report.InjectAnnotationAt, configLabels)).Inc()
  patchType := admissionv1beta1.PatchTypeJSONPatch
  return &amp;admissionv1beta1.AdmissionResponse{
    UID:       request.UID,
    Allowed:   true,
    PatchType: &amp;patchType,
    Patch:     patchJSON,
  }, nil
}
...
func (conf *ResourceConfig) GetPodPatch(injectProxy bool) ([]byte, error) {
	namedPorts := make(map[string]int32)
	if conf.HasPodTemplate() {
		namedPorts = util.GetNamedPorts(conf.pod.spec.Containers)
	}
	values, err := GetOverriddenValues(conf.values, conf.getAnnotationOverrides(), namedPorts)
	values.Proxy.PodInboundPorts = getPodInboundPorts(conf.pod.spec)
	if err != nil {
		return nil, fmt.Errorf(&quot;could not generate Overridden Values: %w&quot;, err)
	}
	if values.ClusterNetworks != &quot;&quot; {
		for _, network := range strings.Split(strings.Trim(values.ClusterNetworks, &quot;,&quot;), &quot;,&quot;) {
			if _, _, err := net.ParseCIDR(network); err != nil {
				return nil, fmt.Errorf(&quot;cannot parse destination get networks: %w&quot;, err)
			}
		}
	}
	patch := &amp;podPatch{
		Values:      *values,
		Annotations: map[string]string{},
		Labels:      map[string]string{},
	}
	switch strings.ToLower(conf.workload.metaType.Kind) {
	case k8s.Pod:
	case k8s.CronJob:
		patch.PathPrefix = &quot;/spec/jobTemplate/spec/template&quot;
	default:
		patch.PathPrefix = &quot;/spec/template&quot;
	}
	if conf.pod.spec != nil {
		conf.injectPodAnnotations(patch)
		if injectProxy {
			conf.injectObjectMeta(patch)
			conf.injectPodSpec(patch)
		} else {
			patch.Proxy = nil
			patch.ProxyInit = nil
		}
	}
	rawValues, err := yaml.Marshal(patch)
	if err != nil {
		return nil, err
	}
	files := []*loader.BufferedFile{
		{Name: chartutil.ChartfileName},
		{Name: &quot;requirements.yaml&quot;},
		{Name: &quot;templates/patch.json&quot;},
	}
	chart := &amp;charts.Chart{
		Name:      &quot;patch&quot;,
		Dir:       &quot;patch&quot;,
		Namespace: conf.namespace,
		RawValues: rawValues,
		Files:     files,
		Fs:        static.Templates,
	}
	buf, err := chart.Render()
	if err != nil {
		return nil, err
	}
	res := rTrail.ReplaceAll(buf.Bytes(), []byte(&quot;\n&quot;))
	return res, nil
}
</code></pre>
<p>Deployment Events에서 관련 로그를 볼 수 있습니다.</p>
<pre><code>kubectl describe deployment/simple-app-v1 -n simple-app
...
Events:
  Type    Reason             Age                    From                    Message
  ----    ------             ----                   ----                    -------
  Normal  ScalingReplicaSet  2m26s                  deployment-controller   Scaled up replica set simple-app-v1-658b475d7c from 0 to 1
  Normal  Injected           2m25s (x2 over 2m26s)  linkerd-proxy-injector  Linkerd sidecar proxy injected
  Normal  ScalingReplicaSet  2m25s                  deployment-controller   Scaled up replica set simple-app-v1-76fc99b86b from 0 to 1
  Normal  ScalingReplicaSet  2m19s                  deployment-controller   Scaled down replica set simple-app-v1-658b475d7c from 1 to 0
</code></pre>
<p>JSON이 생성된 후, <code>chart.Render()</code>를 호출하여 Kubernetes가 적용할 결과 바이트 배열을 반환합니다. 들어오는 admission 요청의 원시 바이트 배열을 확인할 수 있으며, 여기에는 신뢰 앵커 PEM, Linkerd 관련 주석 및 Pod 사양이 포함됩니다. 예를 들어:</p>
<pre><code>time=&quot;2025-06-04T11:19:18Z&quot; level=debug msg=&quot;admission request: &amp;AdmissionRequest{UID:919c6889-a59c-4168-be0d-6d448460af98,Kind:/v1, Kind=Service,Resource:{ v1 services},SubResource:,Name:simple-app-v2,Namespace:simple-app,Operation:CREATE,UserInfo:{system:admin  [system:masters system:authenticated] map[authentication.kubernetes.io/credential-id:[X509SHA256=4bc6de6278f805fc173745e09f4a564b7c7b4fac138201f729d912cd623fa55b]]},Object:{[123 34 97 112 105 86 101 114 115 105 111 110 34 58 34 118 49 34 44 34 107 105 110 100 34 58 34 83 101 114 118 105 99 101 34 44 34 109 101 116 97 100 97 116 97 34 58 123 34 97 110 110 111 116 97 116 105 111 110 115 34 58 123 34 107 117 98 101 99 116 108 46 107 117 98 101 114 110 101 116 101 115 46 105 111 47 108 97 115 116 45 97 112 112 108 105 101 100 45 99 111 110 102 105 103 117 114 97 116 105 111 110 34 58 34 123 92 34 97 112 105 86 101 114 115 105 111 110 92 34 58 92 34 118 49 92 34 44 92 34 107 105 110 100 92 34 58 92 34 83 101 114 118 105 99 101 92 34 44 92 34 109 101 116 97 100 97 116 97 92 34 58 123 92 34 97 110 110 111 116 97 116 105 111 110 115 92 34 58 123 125 44 92 34 110 97 109 101 92 34 58 92 34 115 105 109 112 108 101 45 97 112 112 45 118 50 92 34 44 92 34 110 97 109 101 115 112 97 99 101 92 34 58 92 34 115 105 109 112 108 101 45 97 112 112 92 34 125 44 92 34 115 112 101 99 92 34 58 123 92 34 112 111 114 116 115 92 34 58 91 123 92 34 112 111 114 116 92 34 58 56 48 44 92 34 116 97 114 103 101 116 80 111 114 116 92 34 58 53 54 55 56 125 93 44 92 34 115 101 108 101 99 116 111 114 92 34 58 123 92 34 97 112 112 92 34 58 92 34 115 105 109 112 108 101 45 97 112 112 45 118 50 92 34 44 92 34 118 101 114 115 105 111 110 92 34 58 92 34 118 50 92 34 125 125 125 92 110 34 125 44 34 99 114 101 97 116 105 111 110 84 105 109 101 115 116 97 109 112 34 58 110 117 108 108 44 34 109 97 110 97 103 101 100 70 105 101 108 100 115 34 58 91 123 34 97 112 105 86 101 114 115 105 111 110 34 58 34 118 49 34 44 34 102 105 101 108 100 115 84 121 112 101 34 58 34 70 105 101 108 100 115 86 49 34 44 34 102 105 101 108 100 115 86 49 34 58 123 34 102 58 109 101 116 97 100 97 116 97 34 58 123 34 102 58 97 110 110 111 116 97 116 105 111 110 115 34 58 123 34 46 34 58 123 125 44 34 102 58 107 117 98 101 99 116 108 46 107 117 98 101 114 110 101 116 101 115 46 105 111 47 108 97 115 116 45 97 112 112 108 105 101 100 45 99 111 110 102 105 103 117 114 97 116 105 111 110 34 58 123 125 125 125 44 34 102 58 115 112 101 99 34 58 123 34 102 58 105 110 116 101 114 110 97 108 84 114 97 102 102 105 99 80 111 108 105 99 121 34 58 123 125 44 34 102 58 112 111 114 116 115 34 58 123 34 46 34 58 123 125 44 34 107 58 123 92 34 112 111 114 116 92 34 58 56 48 44 92 34 112 114 111 116 111 99 111 108 92 34 58 92 34 84 67 80 92 34 125 34 58 123 34 46 34 58 123 125 44 34 102 58 112 111 114 116 34 58 123 125 44 34 102 58 112 114 111 116 111 99 111 108 34 58 123 125 44 34 102 58 116 97 114 103 101 116 80 111 114 116 34 58 123 125 125 125 44 34 102 58 115 101 108 101 99 116 111 114 34 58 123 125 44 34 102 58 115 101 115 115 105 111 110 65 102 102 105 110 105 116 121 34 58 123 125 44 34 102 58 116 121 112 101 34 58 123 125 125 125 44 34 109 97 110 97 103 101 114 34 58 34 107 117 98 101 99 116 108 45 99 108 105 101 110 116 45 115 105 100 101 45 97 112 112 108 121 34 44 34 111 112 101 114 97 116 105 111 110 34 58 34 85 112 100 97 116 101 34 44 34 116 105 109 101 34 58 34 50 48 50 53 45 48 54 45 48 52 84 49 49 58 49 57 58 49 56 90 34 125 93 44 34 110 97 109 101 34 58 34 115 105 109 112 108 101 45 97 112 112 45 118 50 34 44 34 110 97 109 101 115 112 97 99 101 34 58 34 115 105 109 112 108 101 45 97 112 112 34 125 44 34 115 112 101 99 34 58 123 34 105 110 116 101 114 110 97 108 84 114 97 102 102 105 99 80 111 108 105 99 121 34 58 34 67 108 117 115 116 101 114 34 44 34 112 111 114 116 115 34 58 91 123 34 112 111 114 116 34 58 56 48 44 34 112 114 111 116 111 99 111 108 34 58 34 84 67 80 34 44 34 116 97 114 103 101 116 80 111 114 116 34 58 53 54 55 56 125 93 44 34 115 101 108 101 99 116 111 114 34 58 123 34 97 112 112 34 58 34 115 105 109 112 108 101 45 97 112 112 45 118 50 34 44 34 118 101 114 115 105 111 110 34 58 34 118 50 34 125 44 34 115 101 115 115 105 111 110 65 102 102 105 110 105 116 121 34 58 34 78 111 110 101 34 44 34 116 121 112 101 34 58 34 67 108 117 115 116 101 114 73 80 34 125 44 34 115 116 97 116 117 115 34 58 123 34 108 111 97 100 66 97 108 97 110 99 101 114 34 58 123 125 125 125] &lt;nil&gt;},OldObject:{[] &lt;nil&gt;},DryRun:*false,Options:{[123 34 97 112 105 86 101 114 115 105 111 110 34 58 34 109 101 116 97 46 107 56 115 46 105 111 47 118 49 34 44 34 102 105 101 108 100 77 97 110 97 103 101 114 34 58 34 107 117 98 101 99 116 108 45 99 108 105 101 110 116 45 115 105 100 101 45 97 112 112 108 121 34 44 34 102 105 101 108 100 86 97 108 105 100 97 116 105 111 110 34 58 34 83 116 114 105 99 116 34 44 34 107 105 110 100 34 58 34 67 114 101 97 116 101 79 112 116 105 111 110 115 34 125] &lt;nil&gt;},RequestKind:/v1, Kind=Service,RequestResource:/v1, Resource=services,RequestSubResource:,}&quot;
time=&quot;2025-06-04T11:19:18Z&quot; level=debug msg=&quot;request object bytes: {\&quot;apiVersion\&quot;:\&quot;v1\&quot;,\&quot;kind\&quot;:\&quot;Service\&quot;,\&quot;metadata\&quot;:{\&quot;annotations\&quot;:{\&quot;kubectl.kubernetes.io/last-applied-configuration\&quot;:\&quot;{\\\&quot;apiVersion\\\&quot;:\\\&quot;v1\\\&quot;,\\\&quot;kind\\\&quot;:\\\&quot;Service\\\&quot;,\\\&quot;metadata\\\&quot;:{\\\&quot;annotations\\\&quot;:{},\\\&quot;name\\\&quot;:\\\&quot;simple-app-v2\\\&quot;,\\\&quot;namespace\\\&quot;:\\\&quot;simple-app\\\&quot;},\\\&quot;spec\\\&quot;:{\\\&quot;ports\\\&quot;:[{\\\&quot;port\\\&quot;:80,\\\&quot;targetPort\\\&quot;:5678}],\\\&quot;selector\\\&quot;:{\\\&quot;app\\\&quot;:\\\&quot;simple-app-v2\\\&quot;,\\\&quot;version\\\&quot;:\\\&quot;v2\\\&quot;}}}\\n\&quot;},\&quot;creationTimestamp\&quot;:null,\&quot;managedFields\&quot;:[{\&quot;apiVersion\&quot;:\&quot;v1\&quot;,\&quot;fieldsType\&quot;:\&quot;FieldsV1\&quot;,\&quot;fieldsV1\&quot;:{\&quot;f:metadata\&quot;:{\&quot;f:annotations\&quot;:{\&quot;.\&quot;:{},\&quot;f:kubectl.kubernetes.io/last-applied-configuration\&quot;:{}}},\&quot;f:spec\&quot;:{\&quot;f:internalTrafficPolicy\&quot;:{},\&quot;f:ports\&quot;:{\&quot;.\&quot;:{},\&quot;k:{\\\&quot;port\\\&quot;:80,\\\&quot;protocol\\\&quot;:\\\&quot;TCP\\\&quot;}\&quot;:{\&quot;.\&quot;:{},\&quot;f:port\&quot;:{},\&quot;f:protocol\&quot;:{},\&quot;f:targetPort\&quot;:{}}},\&quot;f:selector\&quot;:{},\&quot;f:sessionAffinity\&quot;:{},\&quot;f:type\&quot;:{}}},\&quot;manager\&quot;:\&quot;kubectl-client-side-apply\&quot;,\&quot;operation\&quot;:\&quot;Update\&quot;,\&quot;time\&quot;:\&quot;2025-06-04T11:19:18Z\&quot;}],\&quot;name\&quot;:\&quot;simple-app-v2\&quot;,\&quot;namespace\&quot;:\&quot;simple-app\&quot;},\&quot;spec\&quot;:{\&quot;internalTrafficPolicy\&quot;:\&quot;Cluster\&quot;,\&quot;ports\&quot;:[{\&quot;port\&quot;:80,\&quot;protocol\&quot;:\&quot;TCP\&quot;,\&quot;targetPort\&quot;:5678}],\&quot;selector\&quot;:{\&quot;app\&quot;:\&quot;simple-app-v2\&quot;,\&quot;version\&quot;:\&quot;v2\&quot;},\&quot;sessionAffinity\&quot;:\&quot;None\&quot;,\&quot;type\&quot;:\&quot;ClusterIP\&quot;},\&quot;status\&quot;:{\&quot;loadBalancer\&quot;:{}}}&quot;
time=&quot;2025-06-04T11:19:18Z&quot; level=debug msg=&quot;/var/run/linkerd/config/values config YAML: clusterDomain: cluster.local\nclusterNetworks: 10.0.0.0/8,100.64.0.0/10,172.16.0.0/12,192.168.0.0/16,fd00::/8\ncniEnabled: false\ncommonLabels: {}\ncontrolPlaneTracing: false\ncontrolPlaneTracingNamespace: linkerd-jaeger\ncontroller:\n  podDisruptionBudget:\n    maxUnavailable: 1\ncontrollerGID: -1\ncontrollerImage: ghcr.io/buoyantio/controller\ncontrollerImageVersion: \&quot;\&quot;\ncontrollerLogFormat: plain\ncontrollerLogLevel: debug\ncontrollerReplicas: 1\ncontrollerUID: 2103\ndebugContainer:\n  image:\n    name: cr.l5d.io/linkerd/debug\n    pullPolicy: \&quot;\&quot;\n    version: edge-25.4.4\ndeploymentStrategy:\n  rollingUpdate:\n    maxSurge: 25%\n    maxUnavailable: 25%\ndestinationController:\n  additionalArgs:\n  - -ext-endpoint-zone-weights\n  livenessProbe:\n    timeoutSeconds: 1\n  podAnnotations: {}\n  readinessProbe:\n    timeoutSeconds: 1\ndisableHeartBeat: false\ndisableIPv6: true\negress:\n  globalEgressNetworkNamespace: linkerd-egress\nenableEndpointSlices: true\nenableH2Upgrade: true\nenablePSP: false\nenablePodAntiAffinity: false\nenablePodDisruptionBudget: false\nenablePprof: false\nidentity:\n  externalCA: false\n  issuer:\n    clockSkewAllowance: 20s\n    issuanceLifetime: 24h0m0s\n    scheme: linkerd.io/tls\n    tls:\n      crtPEM: |\n        -----BEGIN CERTIFICATE-----\n        MIIBsjCCAVigAwIBAgIQG4RR1EkQLvanRZspKw9R3jAKBggqhkjOPQQDAjAlMSMw\n        IQYDVQQDExpyb290LmxpbmtlcmQuY2x1c3Rlci5sb2NhbDAeFw0yNTA2MDQxMTE4\n        NDJaFw0yNjA2MDQxMTE4NDJaMCkxJzAlBgNVBAMTHmlkZW50aXR5LmxpbmtlcmQu\n        Y2x1c3Rlci5sb2NhbDBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABKyE5Px3kwpI\n        ZEGR9Ky0feN3/X/3DQOSDweb3B1O6JK4fAtYDetnyUul+T0zXKtrLX0lrAdRzyaj\n        MLhci5ZMEd6jZjBkMA4GA1UdDwEB/wQEAwIBBjASBgNVHRMBAf8ECDAGAQH/AgEA\n        MB0GA1UdDgQWBBSkrmSMxXmF/CJz14sL5SNbwNh9qjAfBgNVHSMEGDAWgBSw5rC0\n        vxQuKzp3Qyo9+367k6kzMTAKBggqhkjOPQQDAgNIADBFAiA7L9KiSSJdKD8WxSXM\n        cLcyqPe7Sw9lBko/Wcgcue80iwIhAJjddq/892QBoQspnTBctEfUVovznJCIMSKq\n        P4YtzyEn\n        -----END CERTIFICATE-----\n  kubeAPI:\n    clientBurst: 200\n    clientQPS: 100\n  livenessProbe:\n    timeoutSeconds: 1\n  podAnnotations: {}\n  readinessProbe:\n    timeoutSeconds: 1\n  serviceAccountTokenProjection: true\nidentityTrustAnchorsPEM: |\n  -----BEGIN CERTIFICATE-----\n  MIIBjTCCATSgAwIBAgIRAIMD4XLxwxvmNPAOcIuzz/EwCgYIKoZIzj0EAwIwJTEj\n  MCEGA1UEAxMacm9vdC5saW5rZXJkLmNsdXN0ZXIubG9jYWwwHhcNMjUwNjA0MTEx\n  ODQyWhcNMzUwNjAyMTExODQyWjAlMSMwIQYDVQQDExpyb290LmxpbmtlcmQuY2x1\n  c3Rlci5sb2NhbDBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABLwQ70dJQiN0LHY6\n  q4fvIND1LqcyypW8P+qrhVuIdHThgPx/KXXLa2+KjAbUzzeu8PRagGriwRn6+A69\n  AixeeuKjRTBDMA4GA1UdDwEB/wQEAwIBBjASBgNVHRMBAf8ECDAGAQH/AgEBMB0G\n  A1UdDgQWBBSw5rC0vxQuKzp3Qyo9+367k6kzMTAKBggqhkjOPQQDAgNHADBEAiAt\n  ZkhSf0dHy7c6dDorCcfUiwNVjSdV2Z+Sl2EJ0ZxorgIgO9hII30K/26KlicbXygh\n  CxaYQ3t5qyY437Z08s11FEg=\n  -----END CERTIFICATE-----\nidentityTrustDomain: cluster.local\nimagePullPolicy: IfNotPresent\nimagePullSecrets: []\nkubeAPI:\n  clientBurst: 200\n  clientQPS: 100\nlicenseResources:\n  resources:\n    limits:\n      cpu: 500m\n      memory: 256Mi\n    requests:\n      cpu: 250m\n      memory: 128Mi\nlicenseSecret: null\nlinkerdVersion: enterprise-2.18.0\nmanageExternalWorkloads: true\nnetworkValidator:\n  connectAddr: \&quot;\&quot;\n  enableSecurityContext: true\n  listenAddr: \&quot;\&quot;\n  logFormat: plain\n  logLevel: debug\n  timeout: 10s\nnodeSelector:\n  kubernetes.io/os: linux\npodAnnotations: {}\npodLabels: {}\npodMonitor:\n  controller:\n    enabled: true\n    namespaceSelector: |\n      matchNames:\n        - {{ .Release.Namespace }}\n        - linkerd-viz\n        - linkerd-jaeger\n  enabled: false\n  labels: {}\n  proxy:\n    enabled: true\n  scrapeInterval: 10s\n  scrapeTimeout: 10s\n  serviceMirror:\n    enabled: true\npolicyController:\n  image:\n    name: ghcr.io/buoyantio/policy-controller\n    pullPolicy: \&quot;\&quot;\n    version: \&quot;\&quot;\n  livenessProbe:\n    timeoutSeconds: 1\n  logLevel: info\n  probeNetworks:\n  - 0.0.0.0/0\n  - ::/0\n  readinessProbe:\n    timeoutSeconds: 1\n  resources:\n    cpu:\n      limit: \&quot;\&quot;\n      request: \&quot;\&quot;\n    ephemeral-storage:\n      limit: \&quot;\&quot;\n      request: \&quot;\&quot;\n    memory:\n      limit: \&quot;\&quot;\n      request: \&quot;\&quot;\npolicyValidator:\n  caBundle: \&quot;\&quot;\n  crtPEM: \&quot;\&quot;\n  externalSecret: false\n  injectCaFrom: \&quot;\&quot;\n  injectCaFromSecret: \&quot;\&quot;\n  namespaceSelector:\n    matchExpressions:\n    - key: config.linkerd.io/admission-webhooks\n      operator: NotIn\n      values:\n      - disabled\npriorityClassName: \&quot;\&quot;\nprofileValidator:\n  caBundle: \&quot;\&quot;\n  crtPEM: \&quot;\&quot;\n  externalSecret: false\n  injectCaFrom: \&quot;\&quot;\n  injectCaFromSecret: \&quot;\&quot;\n  namespaceSelector:\n    matchExpressions:\n    - key: config.linkerd.io/admission-webhooks\n      operator: NotIn\n      values:\n      - disabled\nprometheusUrl: \&quot;\&quot;\nproxy:\n  additionalEnv:\n  - name: BUOYANT_BALANCER_LOAD_LOW\n    value: \&quot;0.1\&quot;\n  - name: BUOYANT_BALANCER_LOAD_HIGH\n    value: \&quot;3.0\&quot;\n  await: true\n  control:\n    streams:\n      idleTimeout: 5m\n      initialTimeout: 3s\n      lifetime: 1h\n  cores: null\n  defaultInboundPolicy: all-unauthenticated\n  disableInboundProtocolDetectTimeout: false\n  disableOutboundProtocolDetectTimeout: false\n  enableExternalProfiles: false\n  enableShutdownEndpoint: false\n  gid: -1\n  image:\n    name: ghcr.io/buoyantio/proxy\n    pullPolicy: \&quot;\&quot;\n    version: \&quot;\&quot;\n  inbound:\n    server:\n      http2:\n        keepAliveInterval: 100s\n        keepAliveTimeout: 100s\n  inboundConnectTimeout: 100ms\n  inboundDiscoveryCacheUnusedTimeout: 90s\n  livenessProbe:\n    initialDelaySeconds: 10\n    timeoutSeconds: 1\n  logFormat: plain\n  logHTTPHeaders: \&quot;off\&quot;\n  logLevel: warn,linkerd=debug,hickory=error,linkerd_proxy_http::client[{headers}]=on\n  metrics:\n    hostnameLabels: false\n  nativeSidecar: false\n  opaquePorts: 25,587,3306,4444,5432,6379,9300,11211\n  outbound:\n    server:\n      http2:\n        keepAliveInterval: 200s\n        keepAliveTimeout: 200s\n  outboundConnectTimeout: 1000ms\n  outboundDiscoveryCacheUnusedTimeout: 5s\n  outboundTransportMode: transport-header\n  ports:\n    admin: 4191\n    control: 4190\n    inbound: 4143\n    outbound: 4140\n  readinessProbe:\n    initialDelaySeconds: 2\n    timeoutSeconds: 1\n  requireIdentityOnInboundPorts: \&quot;\&quot;\n  resources:\n    cpu:\n      limit: \&quot;\&quot;\n      request: \&quot;\&quot;\n    ephemeral-storage:\n      limit: \&quot;\&quot;\n      request: \&quot;\&quot;\n    memory:\n      limit: \&quot;\&quot;\n      request: \&quot;\&quot;\n  runtime:\n    workers:\n      maximumCPURatio: null\n      minimum: 1\n  shutdownGracePeriod: \&quot;\&quot;\n  startupProbe:\n    failureThreshold: 120\n    initialDelaySeconds: 0\n    periodSeconds: 1\n  uid: 2102\n  waitBeforeExitSeconds: 0\nproxyInit:\n  closeWaitTimeoutSecs: 0\n  ignoreInboundPorts: 4567,4568\n  ignoreOutboundPorts: 4567,4568\n  image:\n    name: ghcr.io/buoyantio/proxy-init\n    pullPolicy: \&quot;\&quot;\n    version: enterprise-2.18.0\n  iptablesMode: legacy\n  kubeAPIServerPorts: 443,6443\n  logFormat: \&quot;\&quot;\n  logLevel: \&quot;\&quot;\n  privileged: false\n  runAsGroup: 65534\n  runAsRoot: false\n  runAsUser: 65534\n  skipSubnets: \&quot;\&quot;\n  xtMountPath:\n    mountPath: /run\n    name: linkerd-proxy-init-xtables-lock\nproxyInjector:\n  caBundle: \&quot;\&quot;\n  crtPEM: \&quot;\&quot;\n  externalSecret: false\n  injectCaFrom: \&quot;\&quot;\n  injectCaFromSecret: \&quot;\&quot;\n  livenessProbe:\n    timeoutSeconds: 1\n  namespaceSelector:\n    matchExpressions:\n    - key: config.linkerd.io/admission-webhooks\n      operator: NotIn\n      values:\n      - disabled\n    - key: kubernetes.io/metadata.name\n      operator: NotIn\n      values:\n      - kube-system\n      - cert-manager\n  objectSelector:\n    matchExpressions:\n    - key: linkerd.io/control-plane-component\n      operator: DoesNotExist\n    - key: linkerd.io/cni-resource\n      operator: DoesNotExist\n  podAnnotations: {}\n  readinessProbe:\n    timeoutSeconds: 1\n  timeoutSeconds: 10\nrevisionHistoryLimit: 10\nruntimeClassName: \&quot;\&quot;\nspValidator:\n  livenessProbe:\n    timeoutSeconds: 1\n  readinessProbe:\n    timeoutSeconds: 1\nwebhookFailurePolicy: Ignore\n&quot;
</code></pre>

<h2 id="참고-문헌" class="header-anchor-wrapper">참고 문헌
  <a href="#%ec%b0%b8%ea%b3%a0-%eb%ac%b8%ed%97%8c" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<ul>
<li><a href="https://linkerd.io/2-edge/reference/architecture/">https://linkerd.io/2-edge/reference/architecture/</a></li>
<li><a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/">https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/</a></li>
<li><a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook">https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook</a></li>
<li><a href="https://github.com/linkerd/linkerd2/blob/main/pkg/inject/inject.go">https://github.com/linkerd/linkerd2/blob/main/pkg/inject/inject.go</a></li>
<li><a href="https://github.com/linkerd/linkerd2/blob/main/controller/proxy-injector/webhook.go">https://github.com/linkerd/linkerd2/blob/main/controller/proxy-injector/webhook.go</a></li>
</ul>

</article>
</div>


                
                    
                

                
            </div>
        </main>
<footer>
    <article>Copyright © 2025</article>
</footer>

</body>
</html>
